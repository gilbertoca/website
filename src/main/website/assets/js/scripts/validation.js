"use strict";!function(){angular.module("konikio",["ipCookie","ngRoute","restangular","ui.bootstrap","konikio.users","konikio.validation","konikio.utils"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"partials/validation.html",controller:"ValidationCtrl"}).when("/reset",{templateUrl:"partials/users/new-password.html",controller:"NewPasswordCtrl"})}]).config(["RestangularProvider",function(e){e.setBaseUrl("http://te1.onlinevalidation.konik.io")}]).config(["$httpProvider",function(e){e.interceptors.push(["$injector",function(e){return e.get("AuthInterceptor")}])}]).run(["AuthService",function(e){e.restoreSession()}])}(),angular.module("konikio.validation",["konikio.validation.controller","konikio.validation.validation-service"]),function(){angular.module("konikio.validation.controller",[]).controller("ValidationCtrl",["$scope","$modal","AuthService","ValidationService",function(e,o,i,r){var n,s=function(){e.isAuthenticated=i.isAuthenticated()},t=function(){angular.isObject(n)&&n.dismiss("close")};e.openLogin=function(){t(),n=o.open({templateUrl:"partials/users/login.html",controller:"LoginCtrl",scope:e}),n.result.then(function(){s()})},e.openRegister=function(){t(),n=o.open({templateUrl:"partials/users/register.html",controller:"RegisterCtrl",scope:e})},e.openReset=function(){t(),n=o.open({templateUrl:"partials/users/reset.html",controller:"ResetCtrl",scope:e})},e.logout=function(){i.logout(),s()},e.error={};var a=function(){e.error.message="",e.validationResponse=void 0};e.validate=function(o){a(),angular.isObject(o)?r.validate(o).then(function(o){e.validationResponse=o})["catch"](function(o){e.error.message=o}):e.error.message="Please provide file to validate."},e.findAlarmType=function(e){var o;switch(e){case"VALID":o="alert-success";break;case"INVALID":case"ERROR":o="alert-danger";break;default:o="alert-danger"}return o},s()}])}(),function(){angular.module("konikio.validation.validation-service",[]).factory("ValidationService",["$http","$q","RestangularData","ResponseParser",function(e,o,i,r){var n={};return n.validate=function(e){var n=o.defer(),s=new FormData;return s.append("file",e),i.one("validate").customPOST(s,null,null,{"Content-Type":void 0}).then(function(e){n.resolve(e)})["catch"](function(e){var o=r.getErrorMessageFromResponse(e,"Validation failed.");n.reject(o)}),n.promise},n}]).factory("RestangularData",["Restangular",function(e){return e.withConfig(function(e){e.setDefaultHttpFields({transformRequest:angular.identity})})}])}(),angular.module("konikio.users",["konikio.users.login","konikio.users.register","konikio.users.reset","konikio.users.new-password","konikio.users.auth-interceptor","konikio.users.auth-service","konikio.users.session"]),function(){angular.module("konikio.users.register",[]).controller("RegisterCtrl",["$scope","$modalInstance","AuthService",function(e,o,i){e.error={};var r=function(){e.error.message=""};e.registerUser={firstName:"",lastName:"",company:"",email:"",password:""},e.register=function(n){r(),i.register(n).then(function(){o.close()},function(o){e.error.message=o})},e.cancel=function(){o.dismiss("cancel")}}])}(),function(){angular.module("konikio.users.login",[]).controller("LoginCtrl",["$scope","$modalInstance","AuthService",function(e,o,i){e.error={};var r=function(){e.error.message=""};e.credentials={email:"",password:""},e.login=function(n){r(),i.login(n).then(function(){o.close()},function(o){e.error.message=o})},e.cancel=function(){o.dismiss("cancel")}}])}(),function(){angular.module("konikio.users.reset",[]).controller("ResetCtrl",["$scope","$modalInstance","AuthService",function(e,o,i){e.error={};var r=function(){e.error.message=""};e.credentials={email:""},e.reset=function(n){r(),i.reset(n.email).then(function(){o.close()},function(o){e.error.message=o})},e.cancel=function(){o.dismiss("cancel")}}])}(),function(){angular.module("konikio.users.new-password",[]).controller("NewPasswordCtrl",["$scope","$location","AuthService",function(e,o,i){e.error={};var r=function(){e.error.message=""};e.credentials={password:""},e.newPassword=function(n){r();var s=o.search(),t=s.email,a=s.token;angular.isDefined(t)&&""!==t&&angular.isDefined(a)&&""!==a?i.newPassword(t,a,n.password).then(function(){o.$$search={},o.path("/")},function(o){e.error.message=o}):e.error.message="Missing authentication parameters"}}])}(),function(){angular.module("konikio.users.auth-interceptor",[]).factory("AuthInterceptor",["$q","Session",function(e,o){var i={},r=function(e){return e.headers=e.headers||{},angular.isDefined(o.id)&&(e.headers.Authorization=o.id),e},n=function(o){return e.reject(o)};return i.request=r,i.responseError=n,i}])}(),function(){angular.module("konikio.users.auth-service",[]).factory("AuthService",["$q","Restangular","Session","ResponseParser",function(e,o,i,r){var n={};return n.register=function(i){var n=e.defer();return o.one("register").customPOST(i,null,null,{"Content-Type":"application/json"}).then(function(){n.resolve()})["catch"](function(e){var o=r.getErrorMessageFromResponse(e,"Error during registration!");n.reject(o)}),n.promise},n.login=function(n){var s=e.defer();return o.one("login").customPOST(n,null,null,{"Content-Type":"application/json"}).then(function(e){i.create(e.token,n.email),s.resolve()})["catch"](function(e){var o=r.getErrorMessageFromResponse(e,"Error during log in!");s.reject(o)}),s.promise},n.reset=function(i){var n=e.defer();return o.one("resetPassword").customPOST(i,null,null,{"Content-Type":"application/json"}).then(function(){n.resolve()})["catch"](function(e){var o=r.getErrorMessageFromResponse(e,"Error while resetting password!");n.reject(o)}),n.promise},n.newPassword=function(n,s,t){var a=e.defer(),l={user:{email:n,password:t},token:s};return o.one("changePassword").customPOST(l,null,null,{"Content-Type":"application/json"}).then(function(e){i.create(e.token,n),a.resolve()})["catch"](function(e){var o=r.getErrorMessageFromResponse(e,"Error while setting new password!");a.reject(o)}),a.promise},n.logout=function(){i.destroy()},n.restoreSession=function(){i.createFromStore()},n.isAuthenticated=function(){return!!i.userId},n}])}(),function(){angular.module("konikio.users.session",[]).service("Session",["ipCookie",function(e){var o="kionikAuth";return this.create=function(i,r){this.id=i,this.userId=r,e(o,{token:i,email:r},{expires:2,expirationUnit:"hours"})},this.createFromStore=function(){var i=e(o);angular.isObject(i)&&this.create(i.token,i.email)},this.destroy=function(){this.id=void 0,this.userId=void 0,this.expiresIn=void 0,e.remove(o)},this}])}(),angular.module("konikio.utils",["konikio.utils.file-model","konikio.utils.response-parser"]),function(){angular.module("konikio.utils.file-model",[]).directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(o,i,r){var n=e("$parent."+r.fileModel),s=n.assign;i.bind("change",function(){o.$apply(function(){s(o,i[0].files[0])})})}}}])}(),function(){angular.module("konikio.utils.response-parser",[]).factory("ResponseParser",function(){var e={};return e.getErrorMessageFromResponse=function(e,o){var i="";return angular.isObject(e)&&angular.isDefined(e.error)?(i=e.error,angular.isDefined(e.message)&&(i+=" "+e.message)):angular.isArray(e)?angular.forEach(e,function(e){i+=i?", ":"",i+=angular.isDefined(e.field)?e.field+": "+e.defaultMessage:e.defaultMessage}):i=o,i},e})}(),function(e){try{e=angular.module("konikio")}catch(o){e=angular.module("konikio",[])}e.run(["$templateCache",function(e){e.put("partials/validation.html",'<div class="container"><div class="row well"><div class="col-lg-6 col-md-6"><h4>Validity test for ZUGFeRD compliant invoices</h4><p>This online service validates ZUGFeRD compliant PDF or XML files using the Konik library.</p><p>If you would like to see a detailed validation report with a semantic validation <a href="http://www.google.com/recaptcha/mailhide/d?k=01q8vnbfNmxk0T5DM_GteAAg==&amp;c=zwuGbJbE2eqJvqdTIykGHA==" onclick="window.open(\'http://www.google.com/recaptcha/mailhide/d?k\\07501q8vnbfNmxk0T5DM_GteAAg\\75\\75\\46c\\75zwuGbJbE2eqJvqdTIykGHA\\75\\075\', \'\', \'toolbar=0,scrollbars=0,location=0,statusbar=0,menubar=0,resizable=0,width=500,height=300\'); return false;" title="Reveal the Email address">contact</a> us for more details.</p><p>Version details</p><dl class="dl-horizontal"><dt>Konik</dt><dd>Version 0.7.1</dd><dt>Validation Service</dt><dd>Version 0.4.1</dd></dl></div><div class="col-lg-6 col-md-6"><form ng-if="isAuthenticated" name="validateForm" ng-submit="validate(fileToValidate)"><div class="form-group"><label for="upload-file">PDF or XML</label> <input type="file" name="file" id="upload-file" file-model="fileToValidate"><p id="upload_file_help_block" class="help-block">Create validation report</p></div><button id="validation-button" type="submit" class="btn btn-primary btn-large" ng-disabled="validateForm.$invalid">Submit</button> <button id="logout-button" ng-click="logout()" class="btn btn-default btn-large">Logout</button></form><button ng-if="!isAuthenticated" id="login-button" class="btn btn-primary" ng-click="openLogin()">Login</button> <button ng-if="!isAuthenticated" id="register-button" class="btn btn-primary" ng-click="openRegister()">Register</button></div></div><div class="row" ng-if="error.message"><div class="alert alert-danger">{{error.message}}</div></div><div id="server_result" class="row" ng-if="validationResponse"><div class="alert {{findAlarmType(validationResponse.status)}}"><p>{{validationResponse.statusMessage}}</p></div><div class="panel panel-default"><div class="panel-heading">Result of the round trip xml-&gt;model-&gt;xml cycle.</div><div class="panel-body">{{validationResponse.compareResult}}</div></div><div class="panel panel-default"><div class="panel-heading">Model validation results</div><table class="table"><thead><tr><th>Path</th><th>Message</th><th>Invalid value</th></tr></thead><tbody><tr ng-repeat="validationResult in validationResponse.validationResult"><td>{{validationResult.Path}}</td><td>{{validationResult.Message}}</td><td>{{validationResult[\'Invalid value\']}}</td></tr></tbody></table></div></div></div>')}])}(),function(e){try{e=angular.module("konikio")}catch(o){e=angular.module("konikio",[])}e.run(["$templateCache",function(e){e.put("partials/users/login.html",'<div class="modal-header"><h2 class="modal-title">Login</h2></div><div class="modal-body"><form name="loginForm" class="form-horizontal" ng-submit="login(credentials)" role="form"><div class="row" ng-if="error.message"><div class="col-sm-12 col-md-12 error">{{error.message}}</div></div><div class="row"><div class="input-group col-sm-12 col-md-12"><span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span> <input id="login-username" type="email" class="form-control" tabindex="1" ng-model="credentials.email" name="email" placeholder="Email address" required=""></div></div><div class="row"><div class="input-group col-sm-12 col-md-12"><span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span> <input id="login-password" type="password" class="form-control" tabindex="2" ng-model="credentials.password" name="password" placeholder="Enter password" required="" min="8"></div></div><div class="row"><div class="col-sm-12 col-md-12"><button type="submit" class="btn btn-primary btn-block btn-lg" tabindex="3" ng-disabled="loginForm.$invalid">Login</button></div></div></form></div><div class="modal-footer"><div class="form-group"><div class="col-md-12 control">Forgot password? <a ng-click="$parent.openReset()">Get new one</a></div></div></div>')}])}(),function(e){try{e=angular.module("konikio")}catch(o){e=angular.module("konikio",[])}e.run(["$templateCache",function(e){e.put("partials/users/new-password.html",'<div class="container"><div class="row well"><div class="col-lg-6 col-md-6 col-md-offset-3 col-lg-offset-3"><div id="loginbox" style="margin-top:50px;"><div class="panel panel-reset"><div class="panel-header"><h2>Enter your new password</h2></div><div class="panel-body"><div class="errorArea" ng-if="error.message"><div class="error">{{error.message}}</div></div><form id="newPasswordForm" class="form-horizontal" ng-submit="newPassword(credentials)" role="form"><div style="margin-bottom: 25px" class="input-group"><span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span> <input id="login-password" type="password" class="form-control" tabindex="1" ng-model="credentials.password" name="password" placeholder="Enter password" required=""></div><div style="margin-top:10px" class="form-group"><div class="col-sm-12 col-md-12"><button type="submit" class="btn btn-primary btn-block btn-lg" tabindex="2" ng-disabled="newPasswordForm.$invalid">Reset</button></div></div><div class="form-group"><div class="col-md-12 control"><div style="border-top: 1px solid#888; padding-top:15px; font-size:85%">Have account already? <a ng-href="/">Back to validation page</a></div></div></div></form></div></div></div></div></div></div>')}])}(),function(e){try{e=angular.module("konikio")}catch(o){e=angular.module("konikio",[])}e.run(["$templateCache",function(e){e.put("partials/users/register.html",'<div class="modal-header"><h2 class="modal-title">Register</h2></div><div class="modal-body"><form name="registerForm" role="form" ng-submit="register(registerUser)"><div class="row" ng-if="error.message"><div class="col-sm-12 col-md-12 error">{{error.message}}</div></div><div class="row"><div class="col-xs-12 col-sm-6 col-md-6"><div class="form-group"><input type="text" name="firstName" ng-model="registerUser.firstName" id="firstName" class="form-control" required="" placeholder="First Name" tabindex="1"></div></div><div class="col-xs-12 col-sm-6 col-md-6"><div class="form-group"><input type="text" name="lastName" ng-model="registerUser.lastName" id="lastName" class="form-control" required="" placeholder="Last Name" tabindex="2"></div></div></div><div class="row"><div class="col-xs-12 col-md-12"><input type="email" name="email" id="email" ng-model="registerUser.email" class="form-control" required="" placeholder="Email address" tabindex="3"></div></div><div class="row"><div class="col-xs-12 col-md-12"><input type="password" name="password" id="password" ng-model="registerUser.password" class="form-control" required="" min="8" placeholder="Enter password" tabindex="4"></div></div><div class="row"><div class="col-xs-12 col-md-12"><input type="text" name="companyName" ng-model="registerUser.company" id="companyName" class="form-control" placeholder="Company Name" tabindex="5"></div></div><div class="row"><div class="col-xs-12 col-md-12"><button type="submit" class="btn btn-primary btn-block btn-lg" tabindex="6" ng-disabled="registerForm.$invalid">Register</button></div></div></form></div><div class="modal-footer"><div class="form-group"><div class="col-md-12 control">If you already have account please <a ng-click="$parent.openLogin()">Log in</a></div></div></div>')}])}(),function(e){try{e=angular.module("konikio")}catch(o){e=angular.module("konikio",[])}e.run(["$templateCache",function(e){e.put("partials/users/reset.html",'<div class="modal-header"><h2 class="modal-title">Reset password</h2></div><div class="modal-body"><form name="resetForm" class="form-horizontal" ng-submit="reset(credentials)" role="form"><div class="row" ng-if="error.message"><div class="col-sm-12 col-md-12 error">{{error.message}}</div></div><div class="row"><div class="input-group col-sm-12 col-md-12"><span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span> <input id="login-username" type="email" class="form-control" tabindex="1" ng-model="credentials.email" name="email" placeholder="Email address" required=""></div></div><div class="row"><div class="col-sm-12 col-md-12"><button type="submit" class="btn btn-primary btn-block btn-lg" tabindex="2" ng-disabled="resetForm.$invalid">Reset</button></div></div></form></div><div class="modal-footer"><div class="form-group"><div class="col-md-12 control">Have account already? <a ng-click="$parent.openLogin()">Log in</a></div></div></div>')}])}();