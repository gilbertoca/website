"use strict";!function(){angular.module("konikio",["ipCookie","restangular","ui.bootstrap","konikio.users","konikio.validation"]).config(["RestangularProvider",function(e){e.setBaseUrl("http://te1.onlinevalidation.konik.io")}]).config(["$httpProvider",function(e){e.interceptors.push(["$injector",function(e){return e.get("AuthInterceptor")}])}]).run(["AuthService",function(e){e.restoreSession()}])}(),angular.module("konikio.validation",["konikio.validation.controller"]),function(){angular.module("konikio.validation.controller",[]).controller("ValidationCtrl",["$scope","$modal","AuthService",function(e,o,i){var r,n=function(){e.isAuthenticated=i.isAuthenticated()},s=function(){angular.isObject(r)&&r.dismiss("close")};e.openLogin=function(){s(),r=o.open({templateUrl:"partials/users/login.html",controller:"LoginCtrl",scope:e}),r.result.then(function(){n()})},e.openRegister=function(){s(),r=o.open({templateUrl:"partials/users/register.html",controller:"RegisterCtrl",scope:e})},e.openReset=function(){s(),r=o.open({templateUrl:"partials/users/reset.html",controller:"ResetCtrl",scope:e})},e.logout=function(){i.logout(),n()},n()}])}(),angular.module("konikio.users",["konikio.users.login","konikio.users.register","konikio.users.reset","konikio.users.auth-interceptor","konikio.users.auth-service","konikio.users.session"]),function(){angular.module("konikio.users.register",[]).controller("RegisterCtrl",["$scope","$modalInstance","AuthService",function(e,o,i){var r=function(){e.error=""};e.registerUser={firstName:"",lastName:"",company:"",email:"",password:""},e.register=function(n){r(),i.register(n).then(function(){o.close()},function(o){e.error=o})},e.cancel=function(){o.dismiss("cancel")}}])}(),function(){angular.module("konikio.users.login",[]).controller("LoginCtrl",["$scope","$modalInstance","AuthService",function(e,o,i){var r=function(){e.error=""};e.credentials={email:"",password:""},e.login=function(n){r(),i.login(n).then(function(){o.close()},function(o){e.error=o})},e.cancel=function(){o.dismiss("cancel")}}])}(),function(){angular.module("konikio.users.reset",[]).controller("ResetCtrl",["$scope","$modalInstance","AuthService",function(e,o,i){var r=function(){e.error=""};e.credentials={email:""},e.reset=function(n){r(),i.reset(n.email).then(function(){o.close()},function(o){e.error=o})},e.cancel=function(){o.dismiss("cancel")}}])}(),function(){angular.module("konikio.users.auth-interceptor",[]).factory("AuthInterceptor",["$q","Session",function(e,o){var i={},r=function(e){return e.headers=e.headers||{},angular.isDefined(o.id)&&(e.headers.Authorization=o.id),e},n=function(o){return e.reject(o)};return i.request=r,i.responseError=n,i}])}(),function(){angular.module("konikio.users.auth-service",[]).factory("AuthService",["$http","$q","Restangular","Session",function(e,o,i,r){var n={};return n.register=function(e){var r=o.defer();return i.one("register").customPOST(e,null,null,{"Content-Type":"application/json"}).then(function(){r.resolve()})["catch"](function(e){if(angular.isObject(e)&&angular.isDefined(e.error))r.reject(e.error);else if(angular.isArray(e)){var o="";angular.forEach(e,function(e){o+=o?", ":"",o+=e.field+": "+e.defaultMessage}),r.reject(o)}else r.reject("Error during registration!")}),r.promise},n.login=function(e){var n=o.defer();return i.one("login").customPOST(e,null,null,{"Content-Type":"application/json"}).then(function(o){r.create(o.token,e.email),n.resolve()})["catch"](function(e){n.reject(angular.isObject(e)?e.error+" "+e.message:"Error during logging in!")}),n.promise},n.reset=function(e){var r=o.defer();return i.one("resetPassword").customPOST(e,null,null,{"Content-Type":"application/json"}).then(function(){r.resolve()})["catch"](function(e){r.reject(angular.isObject(e)?e.error+" "+e.message:"Error during resetting password!")}),r.promise},n.logout=function(){r.destroy()},n.restoreSession=function(){r.createFromStore()},n.isAuthenticated=function(){return!!r.userId},n}])}(),function(){angular.module("konikio.users.session",[]).service("Session",["ipCookie",function(e){var o="kionikAuth";return this.create=function(i,r){this.id=i,this.userId=r,e(o,{token:i,email:r},{expires:2,expirationUnit:"hours"})},this.createFromStore=function(){var i=e(o);angular.isObject(i)&&this.create(i.token,i.email)},this.destroy=function(){this.id=void 0,this.userId=void 0,this.expiresIn=void 0,e.remove(o)},this}])}(),function(e){try{e=angular.module("konikio")}catch(o){e=angular.module("konikio",[])}e.run(["$templateCache",function(e){e.put("partials/users/login.html",'<div class="modal-header"><h2 class="modal-title">Login</h2></div><div class="modal-body"><form name="loginForm" class="form-horizontal" ng-submit="login(credentials)" role="form"><div class="row" ng-show="error"><div class="col-sm-12 col-md-12">{{error}}</div></div><div class="row"><div class="input-group col-sm-12 col-md-12"><span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span> <input id="login-username" type="email" class="form-control" tabindex="1" ng-model="credentials.email" name="email" placeholder="Email address" required=""></div></div><div class="row"><div class="input-group col-sm-12 col-md-12"><span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span> <input id="login-password" type="password" class="form-control" tabindex="2" ng-model="credentials.password" name="password" placeholder="Enter password" required="" min="8"></div></div><div class="row"><div class="col-sm-12 col-md-12"><button type="submit" class="btn btn-primary btn-block btn-lg" tabindex="3" ng-disabled="loginForm.$invalid">Login</button></div></div></form></div><div class="modal-footer"><div class="form-group"><div class="col-md-12 control">Forgot password? <a ng-click="$parent.openReset()">Get new one</a></div></div></div>')}])}(),function(e){try{e=angular.module("konikio")}catch(o){e=angular.module("konikio",[])}e.run(["$templateCache",function(e){e.put("partials/users/register.html",'<div class="modal-header"><h2 class="modal-title">Register</h2></div><div class="modal-body"><form name="registerForm" role="form" ng-submit="register(registerUser)"><div class="row" ng-show="error"><div class="col-sm-12 col-md-12">{{error}}</div></div><div class="row"><div class="col-xs-12 col-sm-6 col-md-6"><div class="form-group"><input type="text" name="firstName" ng-model="registerUser.firstName" id="firstName" class="form-control" required="" placeholder="First Name" tabindex="1"></div></div><div class="col-xs-12 col-sm-6 col-md-6"><div class="form-group"><input type="text" name="lastName" ng-model="registerUser.lastName" id="lastName" class="form-control" required="" placeholder="Last Name" tabindex="2"></div></div></div><div class="row"><div class="col-xs-12 col-md-12"><input type="email" name="email" id="email" ng-model="registerUser.email" class="form-control" required="" placeholder="Email address" tabindex="3"></div></div><div class="row"><div class="col-xs-12 col-md-12"><input type="password" name="password" id="password" ng-model="registerUser.password" class="form-control" required="" min="8" placeholder="Enter password" tabindex="4"></div></div><div class="row"><div class="col-xs-12 col-md-12"><input type="text" name="companyName" ng-model="registerUser.company" id="companyName" class="form-control" placeholder="Company Name" tabindex="5"></div></div><div class="row"><div class="col-xs-12 col-md-12"><button type="submit" class="btn btn-primary btn-block btn-lg" tabindex="6" ng-disabled="registerForm.$invalid">Register</button></div></div></form></div><div class="modal-footer"><div class="form-group"><div class="col-md-12 control">If you already have account please <a ng-click="$parent.openLogin()">Log in</a></div></div></div>')}])}(),function(e){try{e=angular.module("konikio")}catch(o){e=angular.module("konikio",[])}e.run(["$templateCache",function(e){e.put("partials/users/reset.html",'<div class="modal-header"><h2 class="modal-title">Reset password</h2></div><div class="modal-body"><form name="resetForm" class="form-horizontal" ng-submit="reset(credentials)" role="form"><div class="row" ng-show="error"><div class="col-sm-12 col-md-12">{{error}}</div></div><div class="row"><div class="input-group col-sm-12 col-md-12"><span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span> <input id="login-username" type="email" class="form-control" tabindex="1" ng-model="credentials.email" name="email" placeholder="Email address" required=""></div></div><div class="row"><div class="col-sm-12 col-md-12"><button type="submit" class="btn btn-primary btn-block btn-lg" tabindex="2" ng-disabled="resetForm.$invalid">Reset</button></div></div></form></div><div class="modal-footer"><div class="form-group"><div class="col-md-12 control">Have account already? <a ng-click="$parent.openLogin()">Log in</a></div></div></div>')}])}();